(this.webpackJsonpInvmogul=this.webpackJsonpInvmogul||[]).push([[57],{1031:function(t,e,a){"use strict";a.r(e);var c,n=a(18),r=a(4),s=a(17),o=a(9),i=a(7),l=a(0),d=a(1218),u=a(1206),j=a(1228),b=a(1213),p=a(945),O=a(946),f=a(956),h=a(1225),m=a(949),x=a(15),g=a(235),I=a(72),P=(a(112),a(142)),y=a(144),v=a(147),S=a(105),C=a(101),N=a(77),T=a(91),L=a(141),k=(a(646),a(1215)),q=a(286),D=a.n(q),M=a(1220),A=a(233),w=a(381),F=a(645),H=a.n(F),z=a(644),R=a.n(z),E=(a(649),a(1222)),U=a(385),B=a(382),V=a(125),Q=a(198),J=a(196),W=a(1250),G=a(1251),K=a(1252),X=a(146),Y=a(1253),Z=a(145),$=a(2),_=["classes"],tt=(c={productId:"",supplierId:"",name:"",quantity:"",buyingPrice:"",sellingPrice:"",customPrice:!0,reorderLevel:"",stockInHand:"",mainstorePrice:!0,category:"",size:"",description:"",userId:"1",storeId:"",totalPrice:"",shells:"",deposit:"",diffShell:"",gTotalPrice:"",totalDeposit:"",gTotal:"",gDeposit:""},Object(i.a)(c,"userId","1"),Object(i.a)(c,"total",""),Object(i.a)(c,"change",0),Object(i.a)(c,"amntPaid",""),Object(i.a)(c,"depVal",0),Object(i.a)(c,"payMode",""),Object(i.a)(c,"discount",0),Object(i.a)(c,"discountPrice",0),Object(i.a)(c,"customerId",""),Object(i.a)(c,"refNo",""),c),et={createStockIns:T.c,createStoreProduct:C.b,updateStockIn:T.e,updateStoreProducts:C.e,fetchAllStores:P.d,fetchAllUserLevel:y.d,fetchAllSuppliers:v.d,updateStockInHand:S.f,fetchAllProducts:S.d,fetchAllStoreProduct:C.c,fetchAllStockIn:T.d,fetchByStoreIdNProductId:C.d,updateProducts:S.e,createCashSale:N.b,createCashSaleDetails:N.c,fetchAllTransactions:N.e,fetchAllCompanyData:V.d,fetchAllDeposit:Q.d,fetchAllCategory:J.d,fetchAllCustomers:X.d,fetchAllTaxes:Z.d};e.default=Object(I.b)((function(t){return{addStaffList:t.addStaff.list,storesList:t.stores.list,userLevelList:t.userLevel.list,suppliersList:t.suppliers.list,productsList:t.products.list,storeProductsList:t.storeProducts.list,stockInList:t.stockIns.list,storeIdNProductIdList:t.storeProducts.list,salesList:t.cashSale.list,companyDataList:t.companyData.list,depositList:t.deposit.list,categoryList:t.category.list,customersList:t.customers.list,taxList:t.tax.list}}),et)(Object(x.a)((function(t){return{root:{"& .MuiTextField-root":{margin:t.spacing(1),minWidth:230}},formControl:{margin:t.spacing(1),minWidth:230},smMargin:{margin:t.spacing(1)}}}))((function(t){var e=t.classes,a=Object(o.a)(t,_),c=Object(l.useState)(!1),i=Object(s.a)(c,2),x=i[0],I=i[1],P=Object(l.useState)(!1),y=Object(s.a)(P,2),v=y[0],S=y[1],C=Object(l.useState)(!1),N=Object(s.a)(C,2),T=N[0],q=N[1],F=Object(L.useToasts)().addToast,z=Object(l.useState)(0),V=Object(s.a)(z,2),Q=(V[0],V[1]),J=Object(l.useState)(0),X=Object(s.a)(J,2),Z=(X[0],X[1],Object(l.useState)(0)),et=Object(s.a)(Z,2),at=et[0],ct=et[1],nt=Object(l.useState)({}),rt=Object(s.a)(nt,2),st=(rt[0],rt[1],Object(l.useState)(null)),ot=Object(s.a)(st,2),it=(ot[0],ot[1],Object(l.useState)(0)),lt=Object(s.a)(it,2),dt=(lt[0],lt[1],Object(l.useState)(0)),ut=Object(s.a)(dt,2),jt=(ut[0],ut[1],Object(l.useState)(0)),bt=Object(s.a)(jt,2),pt=(bt[0],bt[1],Object(l.useState)(0)),Ot=Object(s.a)(pt,2),ft=(Ot[0],Ot[1],Object(l.useState)(!1)),ht=Object(s.a)(ft,2),mt=ht[0],xt=ht[1],gt=Object(l.useState)(!1),It=Object(s.a)(gt,2),Pt=It[0],yt=It[1],vt=Object(l.useState)(0),St=Object(s.a)(vt,2),Ct=(St[0],St[1],Object(l.useState)(0)),Nt=Object(s.a)(Ct,2),Tt=(Nt[0],Nt[1],Object(l.useState)([])),Lt=Object(s.a)(Tt,2),kt=Lt[0],qt=Lt[1],Dt=Object(l.useState)(0),Mt=Object(s.a)(Dt,2),At=(Mt[0],Mt[1],Object(l.useState)(0)),wt=Object(s.a)(At,2),Ft=(wt[0],wt[1],Object(l.useState)([])),Ht=Object(s.a)(Ft,2),zt=Ht[0],Rt=Ht[1],Et=Object(l.useState)(0),Ut=Object(s.a)(Et,2),Bt=Ut[0],Vt=(Ut[1],Object(l.useState)("")),Qt=Object(s.a)(Vt,2),Jt=Qt[0],Wt=Qt[1],Gt=Object(l.useState)([]),Kt=Object(s.a)(Gt,2),Xt=Kt[0],Yt=Kt[1],Zt=Object(l.useState)([]),$t=Object(s.a)(Zt,2),_t=$t[0],te=$t[1],ee=Object(l.useState)([]),ae=Object(s.a)(ee,2),ce=ae[0],ne=ae[1],re=Object(l.useState)(0),se=Object(s.a)(re,2),oe=se[0],ie=se[1],le=Object(l.useState)(0),de=Object(s.a)(le,2),ue=de[0],je=de[1],be=Object(l.useState)([]),pe=Object(s.a)(be,2),Oe=pe[0],fe=pe[1],he=Object(l.useState)(""),me=Object(s.a)(he,2),xe=(me[0],me[1]),ge=Object(l.useState)(0),Ie=Object(s.a)(ge,2),Pe=Ie[0],ye=Ie[1],ve=Object(l.useState)([]),Se=Object(s.a)(ve,2),Ce=Se[0],Ne=Se[1],Te=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qe,e=Object(r.a)({},Me);if("quantity"in t&&(e.quantity=t.quantity?"":"This field is required"),"sellingPrice"in t&&(e.sellingPrice=t.sellingPrice?"":"This field is required"),"name"in t&&(e.name=t.name?"":"This field is required"),Ae(Object(r.a)({},e)),t==qe)return Object.values(e).every((function(t){return""==t}))},Le=Object(g.a)(tt,Te,a.setCurrentId),ke=Object(s.a)(Le,6),qe=ke[0],De=ke[1],Me=ke[2],Ae=ke[3],we=ke[4],Fe=(ke[5],function(){F("Transaction is Successful",{appearance:"success"}),F("Transaction is Successful",{appearance:"success"}),F("Transaction is Successful",{appearance:"success"})}),He=function(){De(Object(r.a)({},tt)),Ae({})},ze=function(t){Q(t),ct(t)};Object(l.useEffect)((function(){if(a.fetchAllCompanyData(),a.fetchAllProducts(),a.fetchAllStockIn(),a.fetchAllTransactions(),a.fetchAllDeposit(),a.fetchAllCategory(),a.fetchAllCustomers(),a.fetchAllTaxes(),0!=a.currentId||0!=at){De(Object(r.a)(Object(r.a)({},a.productsList.find((function(t){return t.productId==at}))),a.storeProductsList.find((function(t){return t.productId==at}))&&a.storeProductsList.find((function(t){return 2==t.storeId})))),a.fetchAllCompanyData();var t=Object(r.a)({},a.productsList.find((function(t){return t.productId==at})));xe(t.taxId),Re(t.taxId)}Ae({})}),[at]);var Re=function(t){var e=Object(r.a)({},a.taxList.find((function(e){return e.taxId===t})));void 0===e.rate&&(e.rate=0);var c=parseFloat(e.rate/100);ye(c)},Ee=function(){yt(!0)},Ue=kt.reduce((function(t,e){return t+e.total}),0),Be=kt.reduce((function(t,e){return t+e.deposit}),0),Ve=kt.reduce((function(t,e){return t+e.totalPrice}),0),Qe=kt.reduce((function(t,e){return t+e.quantity}),0),Je=kt.reduce((function(t,e){return t+e.tax}),0),We=function(t){for(var e=kt,a=0;a<e.length;a++)if(e[a].productId==t){e.splice(a,1),console.log(a);[].concat(Object(n.a)(kt),[e]);qt(e)}xt(!1)};return Object($.jsxs)($.Fragment,{children:[Object($.jsx)(A.a,{title:"Are you sure you want to remove this product from the cart?",confirmDialog:mt,setConfirmDialog:xt}),Object($.jsx)(w.a,{title:Jt,errorDialog:Pt,setErrorDialog:yt}),Object($.jsx)(B.a,{title:"Reciept",openRPopup:x,setOpenRPopup:I,children:Object($.jsx)(U.a,{companyData:ce,trans:_t,recordList:Xt,setRecordList:Yt,setOpenRPopup:I,totalTax:Je})}),Object($.jsx)(G.a,{title:"Invoice",openIPopup:v,setOpenIPopup:S,children:Object($.jsx)(W.a,{products:kt,setOpenIPopup:S,gTotalPrice:Ve,customerData:Oe,totalTax:Je})}),Object($.jsx)(K.a,{title:"Delivery Note",openDlPopup:T,setOpenDlPopup:q,children:Object($.jsx)(Y.a,{products:kt,setOpenDlPopup:q,gTotalPrice:Ve,customerData:Oe,totalTax:Je})}),Object($.jsx)("section",{className:"content",children:Object($.jsx)("div",{className:"container-fluid",children:Object($.jsxs)("div",{className:"row",children:[Object($.jsx)("div",{className:"col-md-12",children:Object($.jsxs)("div",{className:"card card-primary",children:[Object($.jsx)("div",{className:"card-header",children:Object($.jsxs)("h4",{className:"card-title",children:["Make A Sale ",Object($.jsx)("small",{children:" "})]})}),Object($.jsxs)("form",{id:"quickForm",autoComplete:"off",noValidate:!0,className:e.root,onSubmit:function(t){t.preventDefault();var e=a.categoryList.find((function(t){return t.id==qe.categoryId})),c=a.depositList.find((function(t){return t.name==e.name}));if(qe.depVal=void 0==c?0:c.amount,void 0==qe.shells&&(qe.shells=0),qe.stockInHand<qe.quantity&&(console.log(" oops soory "+qe.stockInHand),Wt("Ooops!! Sorry The requested  Quantity is not available, Availble stock is: "+qe.stockInHand),Ee(),yt({onConfirm:function(){}}),qe.quantity=""),qe.discount>qe.discountLimit)Wt("Ooops!! Sorry, discount should be below: "+qe.discountLimit+" KES"),Ee(),yt({onConfirm:function(){}});else if(Te()){if(qe.quantity>0){qe.discount>0?(qe.discountPrice=parseFloat(qe.sellingPrice-qe.discount),qe.sellingPrice=qe.discountPrice):qe.discount=0;var r={productId:qe.productId,name:qe.name,size:qe.size,sellingPrice:qe.sellingPrice,quantity:parseInt(qe.quantity),discount:parseFloat(qe.discount),totalPrice:Math.round(parseFloat(qe.quantity)*parseFloat(qe.sellingPrice)),total:parseFloat(qe.quantity)*parseFloat(qe.sellingPrice),tax:Math.round(parseFloat(qe.quantity)*parseFloat(qe.sellingPrice)*parseFloat(Pe))},s={transCode:Bt,productId:qe.productId,sellingPrice:qe.sellingPrice,quantity:parseInt(qe.quantity),totalPrice:Math.round(parseFloat(qe.quantity)*parseFloat(qe.sellingPrice)),discount:parseFloat(qe.discount),total:parseFloat(qe.quantity)*parseFloat(qe.sellingPrice),tax:Math.round(parseFloat(qe.quantity)*parseFloat(qe.sellingPrice)*parseFloat(Pe))},o=[].concat(Object(n.a)(kt),[r]),i=[].concat(Object(n.a)(zt),[s]);qt(o),Rt(i),He(),console.log(r)}else Wt("Please specify quantity"),Ee(),yt({onConfirm:function(){}})}},children:[Object($.jsxs)(d.a,{container:!0,children:[Object($.jsx)(d.a,{item:!0,xs:2.5,children:Object($.jsx)(M.a,{className:"form-ctr",sx:{width:30},options:a.customersList,autoHighlight:!0,getOptionLabel:function(t){return t.name},onSelect:we,onChange:function(t,e){ie(e.id),fe(Object(r.a)({},a.customersList.find((function(t){return t.id==e.id}))))},renderInput:function(t){return Object($.jsx)(u.a,Object(r.a)(Object(r.a)({style:{width:"10%"}},t),{},{label:"Choose a Customer",name:"customerId",inputProps:Object(r.a)(Object(r.a)({},t.inputProps),{},{autoComplete:"new-password"}),variant:"outlined",className:"form-ctr",id:"input-with-icon-textfield",value:qe.customerId=oe,onChange:we},Me.customerId&&{error:!0,helperText:Me.customerId}))}})}),Object($.jsx)(d.a,{item:!0,xs:2.5,children:Object($.jsx)(M.a,{className:"form-ctr",sx:{width:30},options:a.productsList,autoHighlight:!0,getOptionLabel:function(t){return t.name},onSelect:we,onChange:function(t,e){var c;je(e.productId),ze(e.productId),c=e.name,Ne(Object(n.a)(a.productsList.filter((function(t){return t.name===c}))))},renderInput:function(t){return Object($.jsx)(u.a,Object(r.a)(Object(r.a)({style:{width:"10%"}},t),{},{label:"Select a product",name:"productId",inputProps:Object(r.a)(Object(r.a)({},t.inputProps),{},{autoComplete:"new-password"}),variant:"outlined",className:"form-ctr",id:"input-with-icon-textfield",value:qe.productId=ue,onChange:we},Me.productId&&{error:!0,helperText:Me.productId}))}})}),Object($.jsx)(d.a,{children:Object($.jsx)(M.a,{className:"form-ctr",sx:{width:30},options:Ce,autoHighlight:!0,getOptionLabel:function(t){return t.size},onSelect:we,onChange:function(t,e){je(e.productId),ze(e.productId)},renderInput:function(t){return Object($.jsx)(u.a,Object(r.a)(Object(r.a)({style:{width:"10%"}},t),{},{label:"Select size",name:"productId",inputProps:Object(r.a)(Object(r.a)({},t.inputProps),{},{autoComplete:"new-password"}),variant:"outlined",className:"form-ctr",id:"input-with-icon-textfield",value:qe.productId=ue,onChange:we},Me.size&&{error:!0,helperText:Me.size}))}})})]}),Object($.jsx)(u.a,Object(r.a)({className:"form-ctr",id:"input-with-icon-textfield",variant:"outlined",type:"text",name:"productId",label:"Product Code",InputLabelProps:{startAdornment:Object($.jsx)(k.a,{position:"start",children:Object($.jsx)(D.a,{})})},value:qe.productId,onChange:function(){var t=Object(r.a)({},a.productsList.find((function(t){return t.productId==at}))),e=t.markup,c=t.buyingPrice,n=c+e/100*c,s=10*Math.ceil(n/10);0!==t.markup&&(qe.sellingPrice=s),De({name:t.name,sellingPrice:qe.sellingPrice,stockInHand:t.stockInHand,discountLimit:t.discountLimit})}},Me.productId&&{error:!0,helperText:Me.productId})),Object($.jsx)(u.a,Object(r.a)({className:"form-ctr",name:"sellingPrice",label:"Unit Price",value:qe.sellingPrice,onChange:we,variant:"outlined"},Me.sellingPrice&&{error:!0,helperText:Me.sellingPrice})),Object($.jsx)(u.a,Object(r.a)({className:"form-ctr",name:"quantity",label:"Quantity",value:qe.quantity,onChange:we,variant:"outlined"},Me.quantity&&{error:!0,helperText:Me.quantity})),Object($.jsx)(u.a,Object(r.a)({className:"form-ctr",name:"discount",label:"Discount",value:qe.discount,onChange:we,variant:"outlined"},Me.discount&&{error:!0,helperText:Me.discount})),Object($.jsx)("br",{}),Object($.jsx)("br",{}),Object($.jsx)("div",{className:"card-footer",children:Object($.jsx)("div",{children:Object($.jsx)("button",{variant:"contained",type:"submit",className:"btn btn-primary",children:"Add To Cart"})})})]}),Object($.jsxs)("form",{id:"quickForm",autoComplete:"off",noValidate:!0,className:e.root,onSubmit:function(t){if(t.preventDefault(),0!=Ue&&""!=qe.payMode){if("Bank"===qe.payMode||"Mpesa"===qe.payMode)if(qe.refNo){var e={transCode:"NS-"+Object(E.a)().substring(0,8).toUpperCase(),gDeposit:Be,totalPrice:Ve,gTotal:Ue,quantity:Qe,amntPaid:parseFloat(Ue),change:qe.change,paymentMode:qe.payMode,userId:window.userId.toString(),totalTax:Je,refNo:qe.refNo};zt.forEach((function(t){t.transCode=e.transCode,a.createCashSaleDetails(t);var c=a.productsList.find((function(e){return e.productId==t.productId})),n=parseInt(c.stockInHand)-parseInt(t.quantity);a.updateStockInHand(t.productId,{stockInHand:n})})),a.createCashSale(e,(function(){Fe(),He()})),I(!0),Yt(kt),te(e),ne(a.companyDataList),He(),qt([])}else Wt("Please enter a refference Number"),Ee(),yt({onConfirm:function(){}});else if("Cash"===qe.payMode){var c={transCode:"NS-"+Object(E.a)().substring(0,8).toUpperCase(),gDeposit:Be,totalPrice:Ve,gTotal:Ue,quantity:Qe,amntPaid:parseFloat(Ue),change:qe.change,paymentMode:qe.payMode,userId:window.userId.toString(),totalTax:Je};zt.forEach((function(t){t.transCode=c.transCode,a.createCashSaleDetails(t);var e=a.productsList.find((function(e){return e.productId==t.productId})),n=parseInt(e.stockInHand)-parseInt(t.quantity);a.updateStockInHand(t.productId,{stockInHand:n})})),a.createCashSale(c,(function(){Fe(),He()})),I(!0),Yt(kt),te(c),ne(a.companyDataList),He(),qt([])}}else Wt("Please select payment mode."),Ee(),yt({onConfirm:function(){}})},children:[Object($.jsx)("div",{className:e.grid,children:Object($.jsxs)("table",{class:"table  .table-responsive{-sm|-md|-lg|-xl|-xxl} table-bordered table-hover table-sm table-striped",children:[Object($.jsx)("thead",{class:"thead-dark",children:Object($.jsxs)("tr",{children:[Object($.jsx)("th",{scope:"col",children:"Name"}),Object($.jsx)("th",{scope:"col",children:"Unit Price"}),Object($.jsx)("th",{scope:"col",children:"Quantity"}),Object($.jsx)("th",{scope:"col",children:"Discount"}),Object($.jsx)("th",{scope:"col",children:"Total Price"}),Object($.jsx)("th",{scope:"col",children:"Total"}),Object($.jsx)("th",{})]})}),Object($.jsx)("tbody",{children:kt.map((function(t){return Object($.jsxs)("tr",{children:[Object($.jsx)("td",{children:t.name}),Object($.jsx)("td",{children:t.sellingPrice}),Object($.jsx)("td",{children:t.quantity}),Object($.jsx)("td",{children:t.discount}),Object($.jsx)("td",{children:t.totalPrice}),Object($.jsx)("td",{children:t.total}),Object($.jsx)("td",{children:Object($.jsxs)(j.a,{variant:"text",children:[Object($.jsx)(b.a,{children:Object($.jsx)(H.a,{color:"primary",onClick:function(){!function(t){De(Object(r.a)({},kt.find((function(e){return e.productId==t})))),We(t)}(t.productId)}})}),Object($.jsx)(b.a,{children:Object($.jsx)(R.a,{color:"Secondary",onClick:function(){xt(!0),xt({onConfirm:function(){We(t.productId)}})}})})]})})]})}))})]})}),Object($.jsx)("br",{}),Object($.jsx)(u.a,Object(r.a)({className:"form-ctr",name:"total",label:"Total Price",value:Ve,onChange:we,variant:"outlined"},Me.gTotalPrice&&{error:!0,helperText:Me.gTotalPrice})),Object($.jsx)(u.a,Object(r.a)({className:"form-ctr",name:"grandTotal",label:"Grand Total",value:Ue,onChange:we,variant:"outlined"},Me.gTotal&&{error:!0,helperText:Me.gTotal})),Object($.jsxs)(p.a,Object(r.a)(Object(r.a)({className:e.formControl},Me.payMode&&{error:!0}),{},{children:[Object($.jsx)(O.a,{children:"Payment Mode"}),Object($.jsxs)(f.a,{className:"form-ctr",name:"payMode",label:"Select Payment Mode",value:qe.payMode,onChange:we,variant:"outlined",children:[Object($.jsx)(h.a,{value:"Mpesa",children:"Mpesa"}),Object($.jsx)(h.a,{value:"Cash",children:"Cash"}),Object($.jsx)(h.a,{value:"Bank",children:"Bank"})]}),Me.payMode&&Object($.jsx)(m.a,{children:Me.payMode})]})),Object($.jsx)(u.a,Object(r.a)({className:"form-ctr",name:"amntPaid",label:"Amount Paid",value:Ue,onChange:we,variant:"outlined"},Me.amntPaid&&{error:!0,helperText:Me.amntPaid})),Object($.jsx)(u.a,Object(r.a)({className:"form-ctr",name:"refNo",label:"Refference No/Mpesa Reciept No",value:qe.refNo,onChange:we,variant:"outlined"},Me.refNo&&{error:!0,helperText:Me.refNo})),Object($.jsx)("div",{className:"card-footer",children:Object($.jsx)("div",{children:Object($.jsx)("button",{variant:"contained",type:"submit",className:"btn btn-primary",children:"Pay"})})})]}),Object($.jsx)("div",{className:"card-footer",children:Object($.jsxs)("div",{children:[Object($.jsx)("button",{variant:"contained",className:"btn btn-primary",onClick:function(){S(!0)},children:"Print Invoice"}),Object($.jsx)("button",{variant:"contained",className:"btn btn-primary",style:{marginLeft:5},onClick:function(){q(!0)},children:"Print Delivery Note"})]})})]})}),Object($.jsx)("div",{className:"col-md-6"})]})})})]})})))}}]);
//# sourceMappingURL=57.386ceecf.chunk.js.map